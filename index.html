<!DOCTYPE html>
<html>
  <head>
    <title>Reaction Game</title>
    <style>
      #box {
        width: 300px;
        height: 200px;
        background-color: red;
        margin: 100px auto;
        color: white;
        font-size: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div id="box">Wait for green...</div>
    <div id="history"></div>
    
    <script>
      let box = document.getElementById("box");
      let tooEarly = true;
      let startTime = 0;
      let reactionTime;
      let clickTimeout;
      let rtArray = JSON.parse(localStorage.getItem('reactionTimeSaved')) || [];

      function startGame() {
        // Clear previous timer if any
        clearTimeout(clickTimeout);

        // Set new delay each time (2-5 seconds)
        let delay = Math.random() * 3000 + 2000;

        box.style.backgroundColor = "red";
        box.textContent = "Wait for green...";
        tooEarly = true;

        clickTimeout = setTimeout(() => {
          box.style.backgroundColor = "green";
          box.textContent = "CLICK!";
          tooEarly = false;
          startTime = Date.now();
        }, delay);
      }

      function updateHistory() {
        let historyDiv = document.getElementById("history");
        historyDiv.innerHTML = "<strong>Previous Times:</strong><br>" + rtArray.map(rt => rt + " ms").join("<br>");
      }

      box.addEventListener("click", function () {
        if (tooEarly) {
          box.textContent = "Too early!";
          clearTimeout(clickTimeout);
          setTimeout(startGame, 2000);
        } else {
          let endTime = Date.now();
          reactionTime = endTime - startTime;
          box.textContent = reactionTime + " ms";
          rtArray.push(reactionTime);

          localStorage.setItem('reactionTimeSaved', JSON.stringify(rtArray));
          updateHistory();
        }

        tooEarly = true;
        setTimeout(startGame, 2000);
      });

      updateHistory();
      startGame();
    </script>
  </body>
</html>
